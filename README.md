# docker-guide
A brief docker guide 
# Docker Guide: Beginner to Intermediate

## Table of Contents
1. [What is Docker?](#what-is-docker)
2. [Why Use Docker?](#why-use-docker)
3. [Core Concepts](#core-concepts)
4. [Installation](#installation)
5. [Basic Commands](#basic-commands)
6. [Working with Images](#working-with-images)
7. [Working with Containers](#working-with-containers)
8. [Dockerfile Basics](#dockerfile-basics)
9. [Docker Compose](#docker-compose)
10. [Volumes and Data Persistence](#volumes-and-data-persistence)
11. [Networking](#networking)
12. [Best Practices](#best-practices)
13. [Common Use Cases](#common-use-cases)

---

## What is Docker?

Docker is a platform that enables developers to package applications and their dependencies into lightweight, portable containers. These containers can run consistently across different environments - from your laptop to production servers.

Think of Docker containers like shipping containers: they standardize how cargo is transported, making it easy to move goods anywhere in the world. Similarly, Docker containers standardize how applications are packaged and deployed.

---

## Why Use Docker?

- **Consistency**: "It works on my machine" becomes "It works everywhere"
- **Isolation**: Applications run in isolated environments
- **Efficiency**: Containers are lightweight compared to virtual machines
- **Scalability**: Easy to scale applications up or down
- **Version Control**: Images can be versioned like code
- **Fast Deployment**: Spin up new environments in seconds

---

## Core Concepts

### Image
A blueprint or template for creating containers. Contains the application code, runtime, libraries, and dependencies.

### Container
A running instance of an image. It's an isolated, executable package that includes everything needed to run the application.

### Dockerfile
A text file with instructions for building a Docker image.

### Registry
A storage and distribution system for Docker images (e.g., Docker Hub).

### Volume
A mechanism for persisting data generated by containers.

---

## Installation

### Linux
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
```

### macOS / Windows
Download Docker Desktop from [docker.com](https://www.docker.com/products/docker-desktop)

### Verify Installation
```bash
docker --version
docker run hello-world
```

---

## Basic Commands

### Check Docker Version
```bash
docker --version
docker info
```

### Get Help
```bash
docker --help
docker <command> --help
```

### List Running Containers
```bash
docker ps
docker ps -a  # Show all containers (including stopped)
```

### List Images
```bash
docker images
docker image ls
```

### Remove Containers and Images
```bash
docker rm <container_id>
docker rmi <image_id>
docker system prune  # Clean up unused resources
```

---

## Working with Images

### Pull an Image from Docker Hub
```bash
docker pull nginx
docker pull nginx:1.21  # Specific version
```

### Search for Images
```bash
docker search python
```

### Build an Image
```bash
docker build -t myapp:1.0 .
docker build -t myapp:latest -f Dockerfile.prod .
```

### Tag an Image
```bash
docker tag myapp:1.0 username/myapp:1.0
```

### Push to Registry
```bash
docker login
docker push username/myapp:1.0
```

### Inspect an Image
```bash
docker image inspect nginx
docker history nginx  # Show image layers
```

---

## Working with Containers

### Run a Container
```bash
# Basic run
docker run nginx

# Run in detached mode (background)
docker run -d nginx

# Run with name
docker run -d --name my-nginx nginx

# Run with port mapping
docker run -d -p 8080:80 nginx

# Run with environment variables
docker run -d -e MYSQL_ROOT_PASSWORD=secret mysql

# Run interactively
docker run -it ubuntu bash
```

### Container Lifecycle
```bash
# Start a stopped container
docker start <container_id>

# Stop a running container
docker stop <container_id>

# Restart a container
docker restart <container_id>

# Pause/unpause
docker pause <container_id>
docker unpause <container_id>

# Remove a container
docker rm <container_id>
docker rm -f <container_id>  # Force remove running container
```

### Execute Commands in Running Container
```bash
docker exec -it <container_id> bash
docker exec <container_id> ls /app
```

### View Logs
```bash
docker logs <container_id>
docker logs -f <container_id>  # Follow logs
docker logs --tail 100 <container_id>  # Last 100 lines
```

### Inspect Container
```bash
docker inspect <container_id>
docker stats <container_id>  # Resource usage
docker top <container_id>  # Running processes
```

### Copy Files
```bash
# From container to host
docker cp <container_id>:/path/in/container /path/on/host

# From host to container
docker cp /path/on/host <container_id>:/path/in/container
```

---

## Dockerfile Basics

A Dockerfile defines how to build your Docker image.

### Simple Example
```dockerfile
# Use official Python runtime as base image
FROM python:3.9-slim

# Set working directory
WORKDIR /app

# Copy requirements file
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Expose port
EXPOSE 5000

# Define environment variable
ENV FLASK_APP=app.py

# Run application
CMD ["python", "app.py"]
```

### Common Dockerfile Instructions

```dockerfile
# Base image
FROM ubuntu:20.04

# Maintainer info
LABEL maintainer="you@example.com"

# Run commands during build
RUN apt-get update && apt-get install -y curl

# Set environment variables
ENV APP_HOME=/app
ENV NODE_ENV=production

# Set working directory
WORKDIR /app

# Copy files
COPY package.json .
COPY . /app

# Add files (with auto-extraction)
ADD archive.tar.gz /app

# Expose ports
EXPOSE 3000 8080

# Create volume mount points
VOLUME ["/data"]

# Default user
USER appuser

# Command to run (can be overridden)
CMD ["npm", "start"]

# Entrypoint (harder to override)
ENTRYPOINT ["python"]
CMD ["app.py"]
```

### Multi-Stage Build Example
```dockerfile
# Build stage
FROM node:16 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Production stage
FROM node:16-slim
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY package*.json ./
RUN npm install --production
EXPOSE 3000
CMD ["node", "dist/index.js"]
```

---

## Docker Compose

Docker Compose allows you to define and run multi-container applications.

### Installation
Docker Desktop includes Compose. For Linux:
```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### Basic docker-compose.yml
```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
    depends_on:
      - api

  api:
    build: ./api
    ports:
      - "5000:5000"
    environment:
      - DATABASE_URL=postgres://db:5432/mydb
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      - POSTGRES_PASSWORD=secret
      - POSTGRES_DB=mydb
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### Docker Compose Commands
```bash
# Start services
docker-compose up
docker-compose up -d  # Detached mode

# Stop services
docker-compose down
docker-compose down -v  # Also remove volumes

# View logs
docker-compose logs
docker-compose logs -f api  # Follow specific service

# List services
docker-compose ps

# Execute command in service
docker-compose exec web bash

# Build/rebuild services
docker-compose build
docker-compose up --build

# Scale services
docker-compose up --scale api=3
```

### Complete Example (MERN Stack)
```yaml
version: '3.8'

services:
  mongodb:
    image: mongo:5
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
    volumes:
      - mongo_data:/data/db

  backend:
    build: ./backend
    ports:
      - "5000:5000"
    environment:
      - MONGO_URI=mongodb://admin:password@mongodb:27017/myapp?authSource=admin
      - JWT_SECRET=mysecret
    depends_on:
      - mongodb
    volumes:
      - ./backend:/app
      - /app/node_modules

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5000
    depends_on:
      - backend
    volumes:
      - ./frontend:/app
      - /app/node_modules

volumes:
  mongo_data:
```

---

## Volumes and Data Persistence

Containers are ephemeral - data is lost when they're removed. Volumes persist data.

### Types of Mounts

#### Named Volumes (Recommended)
```bash
# Create volume
docker volume create mydata

# Use volume
docker run -d -v mydata:/app/data nginx

# List volumes
docker volume ls

# Inspect volume
docker volume inspect mydata

# Remove volume
docker volume rm mydata
```

#### Bind Mounts (Development)
```bash
# Mount host directory into container
docker run -d -v /host/path:/container/path nginx
docker run -d -v $(pwd):/app node:16
```

#### tmpfs Mounts (Temporary)
```bash
docker run -d --tmpfs /tmp nginx
```

### Volume Examples
```bash
# Database with persistent storage
docker run -d \
  --name postgres \
  -v pgdata:/var/lib/postgresql/data \
  -e POSTGRES_PASSWORD=secret \
  postgres:13

# Development with live reload
docker run -d \
  -v $(pwd):/app \
  -v /app/node_modules \
  -p 3000:3000 \
  node:16
```

---

## Networking

Docker provides several networking options for container communication.

### Network Types

- **bridge**: Default network, containers on same host
- **host**: Container uses host's network directly
- **none**: No networking
- **overlay**: Multi-host networking (Swarm)

### Network Commands
```bash
# List networks
docker network ls

# Create network
docker network create mynetwork
docker network create --driver bridge mynetwork

# Inspect network
docker network inspect mynetwork

# Connect container to network
docker network connect mynetwork container_name

# Disconnect
docker network disconnect mynetwork container_name

# Remove network
docker network rm mynetwork
```

### Using Networks
```bash
# Create custom network
docker network create app-network

# Run containers on same network
docker run -d --name db --network app-network postgres
docker run -d --name api --network app-network myapi

# Containers can communicate using names
# api can reach db at: postgres://db:5432
```

### Docker Compose Networking
```yaml
version: '3.8'

services:
  web:
    image: nginx
    networks:
      - frontend

  api:
    image: myapi
    networks:
      - frontend
      - backend

  db:
    image: postgres
    networks:
      - backend

networks:
  frontend:
  backend:
```

---

## Best Practices

### Image Building
1. **Use official base images** when possible
2. **Use specific tags**, not `latest`
3. **Minimize layers** - combine RUN commands
4. **Order instructions** from least to most frequently changing
5. **Use .dockerignore** to exclude unnecessary files
6. **Use multi-stage builds** to reduce image size
7. **Don't run as root** - create a user

### Example .dockerignore
```
node_modules
npm-debug.log
.git
.env
*.md
.DS_Store
```

### Security
- Don't store secrets in images
- Use secrets management (Docker secrets, environment variables)
- Scan images for vulnerabilities
- Keep images updated
- Use read-only filesystems when possible

### Performance
- Use appropriate base images (alpine for smaller size)
- Leverage build cache
- Remove unnecessary dependencies
- Use volumes for development
- Limit container resources

### Example Optimized Dockerfile
```dockerfile
# Use specific version
FROM node:16-alpine

# Create non-root user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

# Set working directory
WORKDIR /app

# Copy dependency files
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production && \
    npm cache clean --force

# Copy application
COPY --chown=nodejs:nodejs . .

# Switch to non-root user
USER nodejs

# Expose port
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=3s \
  CMD node healthcheck.js

# Start application
CMD ["node", "index.js"]
```

---

## Common Use Cases

### 1. Local Development Environment
```bash
# PostgreSQL database
docker run -d \
  --name dev-db \
  -p 5432:5432 \
  -e POSTGRES_PASSWORD=devpass \
  -v pgdata:/var/lib/postgresql/data \
  postgres:13

# Redis cache
docker run -d \
  --name dev-redis \
  -p 6379:6379 \
  redis:6-alpine
```

### 2. Testing Environment
```yaml
# docker-compose.test.yml
version: '3.8'

services:
  test-db:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: test

  app-test:
    build: .
    command: npm test
    depends_on:
      - test-db
    environment:
      DATABASE_URL: postgres://test-db:5432/test
```

### 3. Continuous Integration
```dockerfile
# Dockerfile.ci
FROM node:16
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run lint
RUN npm test
RUN npm run build
```

### 4. Microservices
```yaml
version: '3.8'

services:
  api-gateway:
    build: ./gateway
    ports:
      - "80:80"

  user-service:
    build: ./services/users
    environment:
      - DB_HOST=user-db

  product-service:
    build: ./services/products
    environment:
      - DB_HOST=product-db

  user-db:
    image: postgres:13

  product-db:
    image: postgres:13
```

---

## Quick Reference

### Most Used Commands
```bash
# Images
docker pull <image>
docker build -t <name> .
docker images
docker rmi <image>

# Containers
docker run -d -p 8080:80 --name web nginx
docker ps
docker stop <container>
docker rm <container>
docker logs <container>
docker exec -it <container> bash

# Compose
docker-compose up -d
docker-compose down
docker-compose logs -f

# Cleanup
docker system prune -a
docker volume prune
```

### Useful Flags
- `-d`: Detached mode (background)
- `-it`: Interactive terminal
- `-p`: Port mapping
- `-v`: Volume mount
- `-e`: Environment variable
- `--name`: Container name
- `--rm`: Auto-remove on stop
- `--network`: Specify network

---

## Next Steps

To advance further with Docker:
1. Learn about Docker Swarm for orchestration
2. Explore Kubernetes for production orchestration
3. Study container security in depth
4. Practice building complex multi-container applications
5. Learn CI/CD integration with Docker
6. Explore monitoring and logging solutions

## Resources

- Official Documentation: https://docs.docker.com
- Docker Hub: https://hub.docker.com
- Docker Compose: https://docs.docker.com/compose
- Best Practices: https://docs.docker.com/develop/dev-best-practices

---

Happy Dockerizing! 🐳
